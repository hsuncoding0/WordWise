<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WordWise Ëã±ÂñÆÈÄö</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f0f4f8;
      --text: #1f2937;
      --card: #ffffff;
      --primary: #3b82f6;
      --accent: #10b981;
    }
    body.dark {
      --bg: #1e293b;
      --text: #f8fafc;
      --card: #334155;
      --primary: #60a5fa;
      --accent: #34d399;
    }

    * { box-sizing: border-box; }
    body {
      font-family: 'Noto Sans TC', sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: background 0.5s, color 0.5s;
    }
    h1 {
      margin-bottom: 1rem;
      animation: fadeInDown 0.8s ease;
    }
    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      animation: fadeIn 1s ease;
      flex-wrap: wrap;
      justify-content: center;
    }
    input[type="text"] {
      padding: 10px;
      width: 240px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
    }
    button, .toggle-btn {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s;
    }
    button:hover, .toggle-btn:hover {
      background-color: #2563eb;
      transform: scale(1.05);
    }
    .result, .history, .favorites {
      margin-top: 20px;
      background: var(--card);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      max-width: 700px;
      width: 100%;
      animation: fadeInUp 0.6s ease;
    }
    .word-title {
      font-size: 24px;
      font-weight: bold;
      color: var(--primary);
    }
    .phonetics { margin-bottom: 10px; }
    .part-of-speech {
      font-weight: bold;
      margin-top: 12px;
    }
    ul {
      padding-left: 20px;
    }
    .chinese {
      margin-top: 10px;
      font-weight: bold;
      color: var(--accent);
    }
    .history-item, .fav-item {
      display: inline-block;
      background: #e5e7eb;
      color: #111827;
      padding: 6px 10px;
      margin: 4px;
      border-radius: 6px;
      cursor: pointer;
    }
    .tts-btn, .fav-btn {
      margin-top: 10px;
      margin-right: 10px;
      background: #64748b;
    }
    .tts-btn:hover, .fav-btn:hover {
      background: #475569;
    }
    .suggestions {
      margin-top: 8px;
      font-size: 14px;
    }
    .suggestions span {
      background: #f3f4f6;
      padding: 4px 8px;
      margin: 2px;
      border-radius: 6px;
      cursor: pointer;
      display: inline-block;
    }

    @keyframes fadeIn { from {opacity: 0; transform: translateY(10px);} to {opacity: 1; transform: translateY(0);} }
    @keyframes fadeInDown { from {opacity: 0; transform: translateY(-20px);} to {opacity: 1; transform: translateY(0);} }
    @keyframes fadeInUp { from {opacity: 0; transform: translateY(20px);} to {opacity: 1; transform: translateY(0);} }
  </style>
</head>
<body>
  <h1><span style="color: var(--primary)">WordWise</span> Ëã±ÂñÆÈÄö</h1>
  <div class="controls">
    <input type="text" id="wordInput" placeholder="Ëº∏ÂÖ•Ëã±ÊñáÂñÆÂ≠ó" oninput="suggestWords()" onkeypress="if(event.key==='Enter') lookupWord()" />
    <button onclick="lookupWord()">Êü•Ë©¢</button>
    <button class="toggle-btn" onclick="toggleDarkMode()">Â§úÈñìÊ®°Âºè</button>
  </div>
  <div class="suggestions" id="suggestions"></div>
  <div class="result" id="result"></div>
  <div class="history" id="history"></div>
  <div class="favorites" id="favorites"></div>

  <script>
    const resultDiv = document.getElementById("result");
    const historyDiv = document.getElementById("history");
    const favoritesDiv = document.getElementById("favorites");
    const suggestionsDiv = document.getElementById("suggestions");

    let dictionaryCache = {};

    function toggleDarkMode() {
      document.body.classList.toggle("dark");
    }

    async function lookupWord(input = null) {
      const word = input || document.getElementById("wordInput").value.trim();
      if (!word) return (resultDiv.innerHTML = "<p>Ë´ãËº∏ÂÖ•ÂñÆÂ≠ó„ÄÇ</p>");
      resultDiv.innerHTML = "<p>Êü•Ë©¢‰∏≠...</p>";

      try {
        const dictRes = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
        if (!dictRes.ok) throw new Error("ÁÑ°Ê≥ïÂèñÂæóÂÆöÁæ©Ë≥áÊñô");
        const data = await dictRes.json();
        dictionaryCache[word] = data;

        let html = `<div class="word-title">${data[0].word}</div>`;
        const phon = data[0].phonetics.find(p => p.text || p.audio);
        if (phon) {
          html += `<div class="phonetics">${phon.text || ""}<br>
                   ${phon.audio ? `<audio controls src="${phon.audio}"></audio>` : ""}</div>`;
        }

        data[0].meanings.forEach(m => {
          html += `<div class="part-of-speech">${m.partOfSpeech}</div><ul>`;
          m.definitions.slice(0, 3).forEach(d => {
            html += `<li>${d.definition}</li>`;
          });
          html += `</ul>`;
        });

        const zhRes = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=zh-TW&dt=t&q=${encodeURIComponent(word)}`);
        const zhData = await zhRes.json();
        const zh = zhData?.[0]?.[0]?.[0] || "ÔºàÁÑ°ÁøªË≠ØÔºâ";
        html += `<div class="chinese">‰∏≠ÊñáÁøªË≠ØÔºö${zh}</div>`;
        html += `<button class="tts-btn" onclick="speakWord('${word}')">üîä ÊúóËÆÄ</button>`;
        html += `<button class="fav-btn" onclick="addFavorite('${word}')">‚≠ê Êî∂Ëóè</button>`;
        resultDiv.innerHTML = html;

        saveHistory(word);
      } catch (err) {
        resultDiv.innerHTML = "<p>Êü•Ë©¢Â§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶„ÄÇ</p>";
        console.error(err);
      }
    }

    function speakWord(word) {
      const msg = new SpeechSynthesisUtterance(word);
      msg.lang = 'en-US';
      window.speechSynthesis.speak(msg);
    }

    function suggestWords() {
      const input = document.getElementById("wordInput").value.trim();
      if (!input || input.length < 2) {
        suggestionsDiv.innerHTML = "";
        return;
      }
      const exampleWords = ["example", "exam", "excellent", "excite", "exercise", "explore", "exit"];
      const suggestions = exampleWords.filter(w => w.startsWith(input.toLowerCase())).slice(0, 5);
      suggestionsDiv.innerHTML = suggestions.map(s => `<span onclick="lookupWord('${s}')">${s}</span>`).join("");
    }

    function saveHistory(word) {
      let history = JSON.parse(localStorage.getItem("history") || "[]");
      if (!history.includes(word)) {
        history.unshift(word);
        if (history.length > 10) history.pop();
        localStorage.setItem("history", JSON.stringify(history));
      }
      renderHistory();
    }

    function addFavorite(word) {
      let fav = JSON.parse(localStorage.getItem("favorites") || "[]");
      if (!fav.includes(word)) {
        fav.unshift(word);
        if (fav.length > 20) fav.pop();
        localStorage.setItem("favorites", JSON.stringify(fav));
      }
      renderFavorites();
    }

    function renderHistory() {
      let history = JSON.parse(localStorage.getItem("history") || "[]");
      if (history.length === 0) return historyDiv.innerHTML = "";
      historyDiv.innerHTML = "<h3>Êü•Ë©¢Á¥ÄÈåÑ</h3>" +
        history.map(w => `<span class="history-item" onclick="lookupWord('${w}')">${w}</span>`).join("");
    }

    function renderFavorites() {
      let fav = JSON.parse(localStorage.getItem("favorites") || "[]");
      if (fav.length === 0) return favoritesDiv.innerHTML = "";
      favoritesDiv.innerHTML = "<h3>Êî∂ËóèÂñÆÂ≠ó</h3>" +
        fav.map(w => `<span class="fav-item" onclick="lookupWord('${w}')">${w}</span>`).join("");
    }

    renderHistory();
    renderFavorites();
  </script>
</body>
</html>
